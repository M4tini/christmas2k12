<!DOCTYPE html>
<html>
<head>
    <title>Christmas2k12 - M4tini</title>
    <meta name="viewport" content="width=1024, initial-scale=1, maximum-scale=1">
</head>
<body>
<script>

// cache globals
var body = document.body;
var width = window.innerWidth;
var height = window.innerHeight;
var r = Math.random;


// tini preparation
var tini = document.getElementById('tini');
if(undefined == tini)
{
    tini = document.createElement('canvas');
    tini.innerHTML = 'Update your browser to FireFox, Chrome or Internet Explorer 9 or higher';
    body.appendChild(tini);
}
var tini_parent = tini.parentNode;
var tini_width = 850;
var tini_height = 580;
var tini_top = height / 2 - tini_height / 2;
var tini_left = width / 2 - tini_width / 2;
var tini_margin = 10; // draw outside the viewing area
var tini_style = tini.style;
tini_style.marginTop = tini_top + 'px';
tini_style.marginLeft = tini_left + 'px';
tini_style.border = '#000 2px solid';
tini_style.borderRadius = '33px';


// prepare canvas
var ctx = tini.getContext('2d');
ctx.canvas.width  = tini_width;
ctx.canvas.height = tini_height;
ctx.font = 'bold 22px Verdana,Arial,sans-serif';
ctx.fillStyle = 'rgba(255,255,255,0.75)';
ctx.fillText('LOADING', tini_width / 2 - ctx.measureText('LOADING').width / 2, tini_height / 2);


// make nice
document.title = 'C H R I S T M A S 2 K 1 2 ~ M 4 T I N I';
var body_style = body.style;
body_style.margin = 0;
body_style.background = '#0a0a0a';


// sini precalculation
var sini_wavelength = 4.46;
var sini_amplitude = 20;
var sini = [];
var sin_pi = Math.floor(Math.PI * 2 * sini_wavelength);
var i = sin_pi - 1;
do
{
    sini[i] = Math.sin(i / sini_wavelength) * sini_amplitude + 1;
}
while(--i >= 0);
var sini_length = sini.length;
var sini_index = 0;


// sini precalculation (snow)
var sin2_wavelength = 20;
var sin2_amplitude = 20;
var sin2 = [];
var sin_pi = Math.floor(Math.PI * 2 * sin2_wavelength);
var i = sin_pi - 1;
do
{
    sin2[i] = Math.sin(i / sin2_wavelength) * sin2_amplitude + 1;
}
while(--i >= 0);
var sin2_length = sin2.length;
var sin2_index = 0;


// star preparation
var star_speed = 3;
var stars = [];
var i = 50;
do
{
    var clone = [];
    clone.x = r() * width;
    clone.y = r() * height;
    clone.s = r() * star_speed + 1;
    clone.a = r() * 2;
    if(r() > .5) clone.a *= -1;
    stars.push(clone);
}
while(--i);


// scroller setup
var tini_x = tini_width;
var scroll_y = 200;
var delay = 0;
var scroller  = [];
var scroller2 = [];
var scroll_text  = '  Christmas | a quick HTML5 demo to wish you a Happy   | ';
var scroll_text2 = '       2k12 |                                New Year  | ';
//scroll_text  = scroll_text.replace(/ /g, '  ').toUpperCase();
scroll_text  = scroll_text.toUpperCase();
scroll_text2 = scroll_text2.toUpperCase();
var scroll_speed = 3;
var scroll_spacing = 5;

// scroller management functions
var scroll_visible = 0;
var scroll_length = scroll_text.length;
function addLetter()
{
    if(scroll_visible == scroll_length) scroll_visible = 0; // endless

    var scroll_char = scroll_text.charAt(scroll_visible);
    var scroll_char2 = scroll_text2.charAt(scroll_visible);
    scroll_visible++;
    if(scroll_char == '|')
    {
        delay = 75;
        return;
    }
    scroller.push(scroll_char);
    scroller2.push(scroll_char2);
}
function removeLetter()
{
    var char = scroller[0];
    scroller.shift();
    scroller2.shift();
    //tini_x += ctx.measureText(char).width + scroll_spacing;

    // font!
    tini_x += 32 + scroll_spacing;
}


// ascii nfo
var nfo_x = 25;
var nfo_y = (tini_height - 525) / 2;
var nfo = [
' ________________________________________________________',
'|%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%|',
'|%%|""""""""""""""""""""""""""""""""""""""""""""""""""|%%|',
'|%%|                                                  |%%|',
'|%%|            ||||||||||||||||||||||||"|            |%%|',
'|%%|            ||||"|    |||| |    |||| |            |%%|',
'|%%|            |||| |    |||| |    |||| |            |%%|',
'|%%|            |||| |    |||| |    |||| |            |%%|',
'|%%|            |||| |    |||| |    |||| |            |%%|',
'|%%|            |||| |    |||| |    |||| |            |%%|',
'|%%|            |____|    |____|    |____|            |%%|',
'|%%|                                                  |%%|',
'|%%|              M4tini Proudly Presents             |%%|',
'|%%|_____""""""""""""""""""""""""""""""""""""""""_____|%%|',
'|%%%%%%|              Christmas 2k12              |%%%%%%|',
'|%%|"""""________________________________________"""""|%%|',
'|%%|             |##|                |##|             |%%|',
'|%%|    _""""""""""""""""""""""""""""""""""""""""_    |%%|',
'|%%|   |  Release Date............... 31-12-2012  |   |%%|',
'|%%|   |                                          |   |%%|',
'|%%|   |  Size............................. 8 Kb  |   |%%|',
'|%%|   |                                          |   |%%|',
'|%%|   |  Type.................. JavaScript Demo  |   |%%|',
'|%%|   |                                          |   |%%|',
'|%%|   |  Code........................... M4tini  |   |%%|',
'|%%|   |                                          |   |%%|',
'|%%|   |  Font............................ matt0  |   |%%|',
'|%%|   |                                          |   |%%|',
'|%%|   |  Music....................... FantomenK  |   |%%|',
'|%%|   |                                          |   |%%|',
'|%%|   |   http://m4tini.com/demo/christmas2k12   |   |%%|',
'|%%|    "________________________________________"    |%%|',
'|%%|             |##|                |##|             |%%|',
'|%%|    _""""""""""""""""""""""""""""""""""""""""_    |%%|',
'|%%|   |  Greetz fly out to:           my family  |   |%%|',
'|%%|___|                          all my friends  |___|%%|',
'|%%%%%%|                       former Wzone crew  |%%%%%%|',
' """"""|                       colleagues at TIG  |""""""',
'       |                              and you ;)  |',
'        "________________________________________"',
'                |##|                  |##|',
'               |##|                    |##|',
'               |#|                      |#|',
'              |#|                        |#|',
'              |"                          "|'
];
for(var i = 0, l = nfo.length; i < l; i++)
{
    nfo[i] = nfo[i].replace(/%/g, '\u2591'); // shade light
    nfo[i] = nfo[i].replace(/#/g, '\u2592'); // shade medium
    nfo[i] = nfo[i].replace(/\|/g, '\u2588'); // black
    nfo[i] = nfo[i].replace(/_/g, '\u2584'); // black bot
    nfo[i] = nfo[i].replace(/"/g, '\u2580'); // black top
}
// font
var tini_font = new Image();
tini_font.src = 'chunky_sans_serif_web.gif';
tini_font.onload = function() {
    // some wait trigger
};
var tini_font_x = {
    'A':0,
    'B':32*1,
    'C':32*2,
    'D':32*3,
    'E':32*4,
    'F':32*5,
    'G':32*6,
    'H':32*7,
    'I':32*8,
    'J':32*9,
    'K':32*10,
    'L':32*11,
    'M':32*12,
    'N':32*13,
    'O':32*14,
    'P':32*15,
    'Q':32*16,
    'R':32*17,
    'S':32*18,
    'T':32*19,
    'U':32*20,
    'V':32*21,
    'W':32*22,
    'X':32*23,
    'Y':32*24,
    'Z':32*25,
    '1':32*26,
    '2':32*27,
    '3':32*28,
    '4':32*29,
    '5':32*30,
    '6':32*31,
    '7':32*32,
    '8':32*33,
    '9':32*34,
    '0':32*35,
    ' ':32*36
};


// audio setup
var audio = document.createElement('audio');
//audio.controls = 'controls';
audio.volume = '0';
audio.loop = 'loop';
audio.preload = 'auto';
var source = document.createElement('source');
source.src = '293004_FantomenK___christmas_x_me.mp3';
audio.appendChild(source);
source = source.cloneNode(true);
source.src = '293004_FantomenK___christmas_x_me.ogg';
audio.appendChild(source);
body.appendChild(audio);

/*
//flash setup
var flash_beat = 0.5;
var flash_bpm = 0.91;
*/

//fade setup
var fade = 1;
var fade_speed = 0.005;


// loop canvas
function tiniLoop()
{
    ctx.font = 'bold 18px Verdana,Arial,sans-serif';

    //audio
    var audio_time = audio.currentTime;
    if(audio_time == 0) return;
    if(audio_time > 87.27)
    {
        audio.currentTime = 0;
        //flash_beat = 0.5;
    }
    //flashing
    var gradient = ctx.createRadialGradient(tini_width, 0, 0, tini_width, 0, tini_width);
    /*
    if(audio_time >= flash_beat)
    {
        gradient.addColorStop(0, 'rgb(95,0,0)');
        gradient.addColorStop(1, 'rgb(45,0,0)');
        flash_beat += flash_bpm;
    }
    else
    {
        gradient.addColorStop(0, 'rgb(95,0,0)');
        gradient.addColorStop(1, 'rgb(45,0,0)');
    }
    */
    gradient.addColorStop(0, 'rgb(95,0,0)');
    gradient.addColorStop(1, 'rgb(45,0,0)');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, tini_width, tini_height);


    // scroll stars
    if(++sin2_index >= sin2_length) sin2_index = 0;

    for(var i = 0, l = stars.length; i < l; i++)
    {
        var star = stars[i];

        star.y += star.s;
        star.x += movex;

        ctx.font = 'bold 16px Verdana,Arial,sans-serif';
        ctx.fillStyle = 'rgba(0,0,0,.25)';
        ctx.fillText('*', star.x + (sin2[sin2_index] * star.a) - 3, star.y + 5);

        ctx.font = 'bold 18px Verdana,Arial,sans-serif';
        ctx.fillStyle = 'rgba(255,255,255,.75)';
        ctx.fillText('*', star.x + (sin2[sin2_index] * star.a), star.y);

        if(star.y > tini_height + tini_margin)
        {
            star.x = r() * tini_width - (100 * movex);
            star.y = 0 - tini_margin;
            star.s = r() * star_speed + 1;
        }
    }


    // scroller
    if(delay > 0) delay--;
    else tini_x -= scroll_speed;

    if(++sini_index >= sini_length) sini_index = 0;

    var sini_let = sini_index;
    var char_x = tini_x;
    for(var i = 0; (e = scroller[i]); i++)
    {
        if(++sini_let >= sini_length) sini_let = 0;

        var opac = .75;
        if(char_x < 450 || char_x > 820) opac = .60;
        if(char_x < 445 || char_x > 825) opac = .45;
        if(char_x < 440 || char_x > 830) opac = .30;
        if(char_x < 435 || char_x > 835) opac = .15;
        if(char_x < 430 || char_x > 840) opac = 0;

        //ctx.fillStyle = 'rgba(0,0,0,' + opac + ')';
        //ctx.fillText(e, char_x, (sini[sini_let] * -1 + scroll_y));

        //ctx.fillStyle = 'rgba(255,255,255,' + opac + ')';
        //ctx.fillText(e, char_x, (sini[sini_let] + scroll_y));

        //char_x += ctx.measureText(e).width + scroll_spacing;

        // font!
        ctx.globalAlpha = opac;
        var f = scroller2[i];
        ctx.drawImage(tini_font, tini_font_x[f], 0, 32, 32, char_x, (sini[sini_let] + scroll_y) + 50, 32, 32);
        ctx.drawImage(tini_font, tini_font_x[e], 0, 32, 32, char_x, (sini[sini_let] + scroll_y), 32, 32);
        ctx.globalAlpha = 1;

        char_x += 32 + scroll_spacing;
    }
    //letter management
    if(char_x <= tini_width) addLetter();
    if(tini_x < 420) removeLetter();


    // snowman
    var snow_x = tini_width * .75;
    var snow_y = tini_height - 80;
    var snow_y_headjump = snow_y + sini[sini_index];
    var snow_y_bodyjump = snow_y + sini[sini_index] * .8;
    var two_pi = Math.PI * 2;
    // body
    var gradient = ctx.createRadialGradient(snow_x, snow_y_bodyjump, 0, snow_x, snow_y_bodyjump, 60);
    gradient.addColorStop(0, 'rgb(255,255,255)');
    gradient.addColorStop(1, 'rgb(100,100,100)');
    ctx.fillStyle = gradient;
    ctx.beginPath();
    ctx.arc(snow_x, snow_y_bodyjump, 60, 0, two_pi, true);
    ctx.closePath();
    ctx.fill();

    var gradient = ctx.createRadialGradient(snow_x, snow_y_headjump - 80, 0, snow_x, snow_y_headjump - 80, 50);
    gradient.addColorStop(0, 'rgb(255,255,255)');
    gradient.addColorStop(1, 'rgb(100,100,100)');
    ctx.fillStyle = gradient;
    ctx.beginPath();
    ctx.arc(snow_x, snow_y_headjump - 80, 50, 0, two_pi, true);
    ctx.closePath();
    ctx.fill();
    // eyes
    ctx.fillStyle = 'rgb(0,0,0)';
    ctx.beginPath();
    ctx.arc(snow_x - 20, snow_y_headjump - 90, 5, 0, two_pi, true);
    ctx.arc(snow_x + 20, snow_y_headjump - 90, 5, 0, two_pi, true);
    ctx.closePath();
    ctx.fill();
    // buttons
    ctx.fillStyle = 'rgb(0,0,0)';
    ctx.beginPath();
    ctx.arc(snow_x, snow_y_bodyjump - 25, 5, 0, two_pi, true);
    ctx.arc(snow_x, snow_y_bodyjump     , 5, 0, two_pi, true);
    ctx.arc(snow_x, snow_y_bodyjump + 25, 5, 0, two_pi, true);
    ctx.closePath();
    ctx.fill();
    // nose
    var gradient = ctx.createRadialGradient(snow_x - 7, snow_y_headjump - 70, 0, snow_x - 7, snow_y_headjump - 70, 14);
    gradient.addColorStop(0, 'rgb(205,85,0)');
    gradient.addColorStop(1, 'rgb(255,100,0)');
    ctx.fillStyle = gradient;
    //ctx.fillStyle = 'rgb(255,100,0)';
    ctx.beginPath();
    ctx.arc(snow_x, snow_y_headjump - 70, 7, 0, two_pi, true);
    ctx.closePath();
    ctx.fill();
    ctx.beginPath();
    ctx.moveTo(snow_x, snow_y_headjump - 77);

    ctx.lineTo(snow_x + 30, snow_y_headjump - 70 + (sini[sini_index] / 4) * -1);
    ctx.lineTo(snow_x,      snow_y_headjump - 63);
    ctx.closePath();
    ctx.fill();


    // draw nfo
    ctx.font = 'bold 12px "Courier New",Courier,sans-serif';
    var nfo_row = nfo_y;
    var sini_nfo = sini_index;
    for(var i = 0, l = nfo.length; i < l; i++)
    {
        if(++sini_nfo >= sini_length) sini_nfo = 0;

        ctx.fillStyle = 'rgba(0,0,0,.25)';
        ctx.fillText(nfo[i], nfo_x + sini[sini_nfo] / sini_wavelength / 2 - 3, nfo_row + 5);
        ctx.fillStyle = 'rgba(255,255,255,.5)';
        ctx.fillText(nfo[i], nfo_x + sini[sini_nfo] / sini_wavelength / 2, nfo_row);
        nfo_row += 12;
    }

    // fade
    if(fade > fade_speed)
    {
        audio.volume += fade_speed;
        ctx.fillStyle = 'rgba(0,0,0,' + fade + ')';
        ctx.fillRect(0, 0, tini_width, tini_height);
        fade -= fade_speed;
    }
}


// monitor mouse
var movex = 1;
body.onmousemove = function(e)
{
    // document position
    var posx = e.pageX;
    var posy = e.pageY;
    // position inside element
    posx -= this.offsetLeft;
    posy -= this.offsetTop;
    // action
         if(posx < width / 4)   movex = -2;
    else if(posx < width / 2)   movex = -.75;
    else if(posx < width / 1.5) movex =  .75;
    else                        movex =  2;
};


//init
setInterval('tiniLoop()', 1000 / 30);
audio.play();

</script>
</body>
</html>